"use strict";(self.webpackChunkbanking_portal=self.webpackChunkbanking_portal||[]).push([[304],{2021:(T,y,d)=>{d.d(y,{w:()=>p});var n=d(3862),c=d(9544),f=d(4358);function S(v,e){if(1&v&&(n.\u0275\u0275elementStart(0,"div",10),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()),2&v){const _=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate(_.secondaryLabel)}}function M(v,e){if(1&v){const _=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",7),n.\u0275\u0275listener("mousedown",function(){const b=n.\u0275\u0275restoreView(_).$implicit,u=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(u.selectOption(b))}),n.\u0275\u0275elementStart(1,"div",8),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(3,S,2,1,"div",9),n.\u0275\u0275elementEnd()}if(2&v){const _=e.$implicit,l=n.\u0275\u0275nextContext(2);n.\u0275\u0275classProp("selected",_.value===l.selectedValue),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(_.label),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",_.secondaryLabel)}}function O(v,e){if(1&v&&(n.\u0275\u0275elementStart(0,"div",5),n.\u0275\u0275template(1,M,4,4,"div",6),n.\u0275\u0275elementEnd()),2&v){const _=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("ngForOf",_.filteredOptions)}}function a(v,e){1&v&&(n.\u0275\u0275elementStart(0,"div",5)(1,"div",11),n.\u0275\u0275text(2," No se encontraron resultados "),n.\u0275\u0275elementEnd()())}let p=(()=>{var v;class e{constructor(){this.options=[],this.placeholder="Buscar...",this.disabled=!1,this.searchTerm="",this.filteredOptions=[],this.selectedValue=null,this.showDropdown=!1,this.onChange=()=>{},this.onTouched=()=>{}}ngOnInit(){this.filteredOptions=this.options}filterOptions(){if(!this.searchTerm||""===this.searchTerm.trim())return void(this.filteredOptions=this.options);const l=this.searchTerm.toLowerCase();this.filteredOptions=this.options.filter(b=>b.label.toLowerCase().includes(l)||b.secondaryLabel&&b.secondaryLabel.toLowerCase().includes(l))}selectOption(l){this.selectedValue=l.value,this.searchTerm=l.label,this.showDropdown=!1,this.onChange(l.value),this.onTouched()}onFocus(){this.showDropdown=!0,this.filterOptions()}onBlur(){setTimeout(()=>{this.showDropdown=!1,this.selectedValue||(this.searchTerm="")},200)}writeValue(l){if(this.selectedValue=l,l){const b=this.options.find(u=>u.value===l);b&&(this.searchTerm=b.label)}else this.searchTerm=""}registerOnChange(l){this.onChange=l}registerOnTouched(l){this.onTouched=l}setDisabledState(l){this.disabled=l}static#e=v=()=>(this.\u0275fac=function(b){return new(b||e)},this.\u0275cmp=n.\u0275\u0275defineComponent({type:e,selectors:[["app-searchable-select"]],inputs:{options:"options",placeholder:"placeholder",disabled:"disabled"},features:[n.\u0275\u0275ProvidersFeature([{provide:f.NG_VALUE_ACCESSOR,useExisting:(0,n.forwardRef)(()=>e),multi:!0}])],decls:7,vars:5,consts:[[1,"searchable-select"],[1,"search-input-wrapper"],["type","text","autocomplete","off",1,"search-input",3,"ngModelChange","focus","blur","input","placeholder","ngModel","disabled"],[1,"dropdown-icon"],["class","dropdown-list",4,"ngIf"],[1,"dropdown-list"],["class","dropdown-item",3,"selected","mousedown",4,"ngFor","ngForOf"],[1,"dropdown-item",3,"mousedown"],[1,"option-label"],["class","option-secondary",4,"ngIf"],[1,"option-secondary"],[1,"dropdown-item","no-results"]],template:function(b,u){1&b&&(n.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"input",2),n.\u0275\u0275twoWayListener("ngModelChange",function(w){return n.\u0275\u0275twoWayBindingSet(u.searchTerm,w)||(u.searchTerm=w),w}),n.\u0275\u0275listener("focus",function(){return u.onFocus()})("blur",function(){return u.onBlur()})("input",function(){return u.filterOptions()}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"span",3),n.\u0275\u0275text(4,"\u25bc"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275template(5,O,2,1,"div",4)(6,a,3,0,"div",4),n.\u0275\u0275elementEnd()),2&b&&(n.\u0275\u0275advance(2),n.\u0275\u0275property("placeholder",u.placeholder),n.\u0275\u0275twoWayProperty("ngModel",u.searchTerm),n.\u0275\u0275property("disabled",u.disabled),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",u.showDropdown&&u.filteredOptions.length>0),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",u.showDropdown&&0===u.filteredOptions.length&&u.searchTerm))},dependencies:[c.CommonModule,c.NgForOf,c.NgIf,f.FormsModule,f.DefaultValueAccessor,f.NgControlStatus,f.NgModel],styles:[".searchable-select[_ngcontent-%COMP%]{position:relative;width:100%}.search-input-wrapper[_ngcontent-%COMP%]{position:relative}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px 35px 10px 12px;border:1px solid #ddd;border-radius:6px;font-size:14px;background-color:#fff;transition:all .2s;box-sizing:border-box}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2;box-shadow:0 0 0 2px #1976d21a}.search-input[_ngcontent-%COMP%]:disabled{background-color:#f5f5f5;cursor:not-allowed}.dropdown-icon[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);pointer-events:none;color:#666;font-size:10px}.dropdown-list[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-radius:6px;margin-top:4px;max-height:250px;overflow-y:auto;box-shadow:0 4px 12px #00000026;z-index:1000}.dropdown-item[_ngcontent-%COMP%]{padding:10px 12px;cursor:pointer;transition:background-color .15s;border-bottom:1px solid #f0f0f0}.dropdown-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.dropdown-item.selected[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.dropdown-item.no-results[_ngcontent-%COMP%]{color:#999;cursor:default;text-align:center}.dropdown-item.no-results[_ngcontent-%COMP%]:hover{background-color:#fff}.option-label[_ngcontent-%COMP%]{font-weight:500;color:#333}.option-secondary[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-top:2px}.dropdown-item.selected[_ngcontent-%COMP%]   .option-label[_ngcontent-%COMP%]{color:#1976d2}"]}))}return v(),e})()},6975:(T,y,d)=>{d.d(y,{D:()=>f});var n=d(3862),c=d(3464);let f=(()=>{var S;class M{constructor(a){this.apiService=a,this.endpoint="/accounts"}getAccounts(a,p){return this.apiService.get(this.endpoint)}getAccountById(a){return this.apiService.get(`${this.endpoint}/${a}`)}getAccountByNumber(a){return this.apiService.get(`${this.endpoint}/number/${a}`)}getAccountsByClient(a,p){return this.apiService.getPaginated(`${this.endpoint}/client/${a}`,p)}searchAccountsByNumber(a,p){return this.apiService.getPaginated(`${this.endpoint}/search`,p,{accountNumber:a})}createAccount(a){return this.apiService.post(this.endpoint,a)}updateAccount(a,p){return this.apiService.put(`${this.endpoint}/${a}`,p)}updateAccountStatus(a,p){return this.apiService.patch(`${this.endpoint}/${a}/status`,{status:p})}deleteAccount(a){return this.apiService.delete(`${this.endpoint}/${a}`)}checkAccountNumberExists(a,p){const v=p?{excludeId:p.toString()}:{};return this.apiService.get(`${this.endpoint}/check-number/${a}`,v)}getAccountBalance(a){return this.apiService.get(`${this.endpoint}/${a}/balance`)}getAccountStats(){return this.apiService.get(`${this.endpoint}/stats`)}getAccountStatsByClient(a){return this.apiService.get(`${this.endpoint}/stats/client/${a}`)}static#e=S=()=>(this.\u0275fac=function(p){return new(p||M)(n.\u0275\u0275inject(c.G))},this.\u0275prov=n.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"root"}))}return S(),M})()},8304:(T,y,d)=>{d.r(y),d.d(y,{MovementsPageComponent:()=>k});var n=d(9544),c=d(4358),f=d(2425),S=d(8219),M=d(1573),O=d(5417),a=d(2021),p=function(i){return i.DEPOSIT="DEPOSIT",i.WITHDRAWAL="WITHDRAWAL",i}(p||{});const v={[p.DEPOSIT]:"Dep\xf3sito",[p.WITHDRAWAL]:"Retiro"};var e=d(3862),_=d(3464);let l=(()=>{var i;class g{constructor(t){this.apiService=t,this.endpoint="/transactions"}getMovements(t,o){return this.apiService.get(this.endpoint)}getMovementById(t){return this.apiService.get(`${this.endpoint}/${t}`)}getMovementsByAccount(t,o){return this.apiService.getPaginated(`${this.endpoint}/account/${t}`,o)}getMovementsByClient(t,o){return this.apiService.getPaginated(`${this.endpoint}/client/${t}`,o)}getMovementsByDateRange(t,o,s){const h={startDate:t.toISOString().split("T")[0],endDate:o.toISOString().split("T")[0]};return this.apiService.getPaginated(this.endpoint,s,h)}createMovement(t){return this.apiService.post(this.endpoint,t)}updateMovement(t,o){return this.apiService.put(`${this.endpoint}/${t}`,o)}deleteMovement(t){return this.apiService.delete(`${this.endpoint}/${t}`)}getMovementStats(){return this.apiService.get(`${this.endpoint}/stats`)}getMovementStatsByAccount(t){return this.apiService.get(`${this.endpoint}/stats/account/${t}`)}getMovementStatsByClient(t){return this.apiService.get(`${this.endpoint}/stats/client/${t}`)}static#e=i=()=>(this.\u0275fac=function(o){return new(o||g)(e.\u0275\u0275inject(_.G))},this.\u0275prov=e.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"root"}))}return i(),g})();var b=d(6975),u=d(5567);function x(i,g){if(1&i&&(e.\u0275\u0275elementStart(0,"div",28),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",r.getFieldError("accountId")," ")}}function w(i,g){if(1&i&&(e.\u0275\u0275elementStart(0,"option",29),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const r=g.$implicit;e.\u0275\u0275property("value",r.value),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",r.label," ")}}function I(i,g){if(1&i&&(e.\u0275\u0275elementStart(0,"div",28),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",r.getFieldError("movementType")," ")}}function A(i,g){if(1&i&&(e.\u0275\u0275elementStart(0,"p")(1,"strong"),e.\u0275\u0275text(2,"Saldo despu\xe9s del retiro:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"currency"),e.\u0275\u0275elementEnd()),2&i){let r;const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275classProp("balance-warning",!t.hasInsufficientBalance)("balance-error",t.hasInsufficientBalance),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind4(4,5,t.selectedAccount.currentBalance-(null==(r=t.movementForm.get("amount"))?null:r.value),"USD","symbol","1.2-2")," ")}}function F(i,g){1&i&&(e.\u0275\u0275elementStart(0,"p",35),e.\u0275\u0275text(1," \u26a0\ufe0f Saldo insuficiente. No puede retirar m\xe1s de lo que tiene disponible. "),e.\u0275\u0275elementEnd())}function D(i,g){if(1&i&&(e.\u0275\u0275elementStart(0,"div",30)(1,"div",31)(2,"h4"),e.\u0275\u0275text(3,"Informaci\xf3n de la Cuenta"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"p")(5,"strong"),e.\u0275\u0275text(6,"N\xfamero:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"p")(9,"strong"),e.\u0275\u0275text(10,"Cliente:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"p",32)(13,"strong"),e.\u0275\u0275text(14,"Saldo Actual:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"currency"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,A,5,10,"p",33)(18,F,2,0,"p",34),e.\u0275\u0275elementEnd()()),2&i){let r;const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",t.selectedAccount.accountNumber),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",(null==t.selectedAccount.client?null:t.selectedAccount.client.name)||"Sin cliente"),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind4(16,5,t.selectedAccount.currentBalance,"USD","symbol","1.2-2")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf","WITHDRAWAL"===(null==(r=t.movementForm.get("movementType"))?null:r.value)&&(null==(r=t.movementForm.get("amount"))?null:r.value)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.hasInsufficientBalance)}}function $(i,g){if(1&i){const r=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(r);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"div",10),e.\u0275\u0275listener("click",function(o){return e.\u0275\u0275restoreView(r),e.\u0275\u0275resetView(o.stopPropagation())}),e.\u0275\u0275elementStart(2,"div",11)(3,"h2",12),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",13),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(r);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"form",14),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(r);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementStart(8,"div",15)(9,"div",16)(10,"label",17),e.\u0275\u0275text(11,"Cuenta"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(12,"app-searchable-select",18),e.\u0275\u0275template(13,x,2,1,"div",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"div",16)(15,"label",17),e.\u0275\u0275text(16,"Tipo de Movimiento"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"select",20)(18,"option",21),e.\u0275\u0275text(19,"Seleccionar tipo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(20,w,2,2,"option",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,I,2,1,"div",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"app-input",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,D,19,10,"div",24),e.\u0275\u0275elementStart(24,"div",25)(25,"app-button",26),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(r);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275text(26," Cancelar "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"app-button",27),e.\u0275\u0275text(28),e.\u0275\u0275elementEnd()()()()()}if(2&i){const r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",r.isEditing?"Editar Movimiento":"Nuevo Movimiento"," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",r.movementForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("options",r.accountOptions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",r.getFieldError("accountId")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",r.movementTypeOptions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",r.getFieldError("movementType")),e.\u0275\u0275advance(),e.\u0275\u0275property("required",!0)("errorMessage",r.getFieldError("amount")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",r.selectedAccount),e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",r.movementForm.invalid||r.loading||r.hasInsufficientBalance),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",r.isEditing?"Actualizar":"Crear"," ")}}let k=(()=>{var i;class g{constructor(t,o,s,h){this.movementService=t,this.accountService=o,this.notificationService=s,this.fb=h,this.movements=[],this.filteredMovements=[],this.accounts=[],this.accountOptions=[],this.searchTerm="",this.showModal=!1,this.isEditing=!1,this.loading=!1,this.currentMovement=null,this.selectedAccount=null,this.pageSize=10,this.totalItems=0,this.tableColumns=[{key:"date",label:"Fecha",sortable:!0,type:"date"},{key:"transactionType",label:"Tipo",sortable:!0},{key:"amount",label:"Valor",sortable:!0,type:"currency"},{key:"balance",label:"Saldo",sortable:!0,type:"currency"},{key:"account.accountNumber",label:"Cuenta",sortable:!0},{key:"account.client.name",label:"Cliente",sortable:!0}],this.tableActions=[{label:"Editar",action:"edit",variant:"primary"},{label:"Eliminar",action:"delete",variant:"danger"}],this.movementTypeOptions=Object.entries(v).map(([m,C])=>({value:m,label:C})),this.destroy$=new f.Subject,this.movementForm=this.createForm(),this.setupFormSubscriptions()}ngOnInit(){this.loadAccounts()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}createForm(){return this.fb.group({accountId:["",c.Validators.required],movementType:["",c.Validators.required],amount:["",[c.Validators.required,c.Validators.min(.01)]]})}setupFormSubscriptions(){this.movementForm.get("accountId")?.valueChanges.pipe((0,f.takeUntil)(this.destroy$)).subscribe(t=>{this.selectedAccount=this.accounts.find(o=>o.id===t||o.accountId===t)||null})}loadMovements(){this.loading=!0,this.movementService.getMovements().pipe((0,f.takeUntil)(this.destroy$)).subscribe({next:t=>{this.movements=t,this.filteredMovements=this.movements,this.totalItems=t.length,this.loading=!1,this.updateAccountOptions()},error:t=>{console.error("Error cargando movimientos:",t),this.notificationService.showError("Error","No se pudieron cargar los movimientos: "+t.message),this.loading=!1}})}loadAccounts(){this.accountService.getAccounts().pipe((0,f.takeUntil)(this.destroy$)).subscribe({next:t=>{this.accounts=t,this.updateAccountOptions(),this.loadMovements()},error:t=>{console.error("Error cargando cuentas:",t),this.notificationService.showError("Error","No se pudieron cargar las cuentas")}})}onSearchChange(t){this.searchTerm=t.target.value,this.filterMovements()}filterMovements(){if(!this.searchTerm||""===this.searchTerm.trim())return void(this.filteredMovements=this.movements);const t=this.searchTerm.toLowerCase();this.filteredMovements=this.movements.filter(o=>{const s=o.account?.accountNumber||"",h=o.account?.client?.name||"",m=o.transactionType||o.movementType||"";return s.toLowerCase().includes(t)||h.toLowerCase().includes(t)||o.description&&o.description.toLowerCase().includes(t)||"DEPOSIT"===m&&"dep\xf3sito".includes(t)||"WITHDRAWAL"===m&&"retiro".includes(t)})}openCreateModal(){this.isEditing=!1,this.currentMovement=null,this.selectedAccount=null,this.movementForm.reset(),this.showModal=!0}openEditModal(t){this.isEditing=!0,this.currentMovement=t,this.movementForm.patchValue({accountId:t.accountId,movementType:t.transactionType||t.movementType,amount:Math.abs(t.amount)}),this.showModal=!0}closeModal(){this.showModal=!1,this.isEditing=!1,this.currentMovement=null,this.selectedAccount=null,this.movementForm.reset()}onSubmit(){if(this.movementForm.valid){this.loading=!0;const t=this.movementForm.value;if("WITHDRAWAL"===t.movementType&&this.selectedAccount&&t.amount>this.selectedAccount.currentBalance)return this.notificationService.showError("Error","Saldo no disponible"),void(this.loading=!1);if(this.isEditing&&this.currentMovement){const o=this.currentMovement.amount,s=Math.abs(t.amount),h=this.currentMovement.balance;let m=h;const C=this.currentMovement.transactionType||this.currentMovement.movementType,P=Math.abs(o);C===t.movementType&&P===s||(m=h-o+("WITHDRAWAL"===t.movementType?-s:s));const B="WITHDRAWAL"===t.movementType?-Math.abs(t.amount):Math.abs(t.amount),N={date:"string"==typeof this.currentMovement.date?this.currentMovement.date:new Date(this.currentMovement.date).toISOString(),transactionType:t.movementType,amount:B,balance:m};this.movementService.updateMovement(this.currentMovement.id||this.currentMovement.transactionId,N).pipe((0,f.takeUntil)(this.destroy$)).subscribe({next:()=>{this.notificationService.showSuccess("\xc9xito","Movimiento actualizado correctamente"),this.closeModal(),this.loadMovements()},error:E=>{this.notificationService.showError("Error","No se pudo actualizar el movimiento"),this.loading=!1}})}else{const o="WITHDRAWAL"===t.movementType?-Math.abs(t.amount):Math.abs(t.amount),s={date:(new Date).toISOString(),accountId:t.accountId,transactionType:t.movementType,amount:o};this.movementService.createMovement(s).pipe((0,f.takeUntil)(this.destroy$)).subscribe({next:()=>{this.notificationService.showSuccess("\xc9xito","Movimiento creado correctamente"),this.closeModal(),this.loadMovements()},error:h=>{this.notificationService.showError("Error","No se pudo crear el movimiento"),this.loading=!1}})}}}onTableAction(t){switch(t.action){case"edit":this.openEditModal(t.row);break;case"delete":this.deleteMovement(t.row)}}deleteMovement(t){confirm("\xbfEst\xe1 seguro de que desea eliminar este movimiento?")&&(this.loading=!0,this.movementService.deleteMovement(t.id||t.transactionId).pipe((0,f.takeUntil)(this.destroy$)).subscribe({next:()=>{this.notificationService.showSuccess("\xc9xito","Movimiento eliminado correctamente"),this.loadMovements()},error:o=>{this.notificationService.showError("Error","No se pudo eliminar el movimiento"),this.loading=!1}}))}onSortChange(t){}getFieldError(t){const o=this.movementForm.get(t);if(o?.errors&&o.touched){if(o.errors.required)return"Este campo es requerido";if(o.errors.min)return`Valor m\xednimo: ${o.errors.min.min}`}return""}get hasInsufficientBalance(){const t=this.movementForm.get("movementType")?.value,o=this.movementForm.get("amount")?.value;return!this.isEditing&&!("WITHDRAWAL"!==t||!this.selectedAccount||!o)&&o>this.selectedAccount.currentBalance}updateAccountOptions(){this.accountOptions=this.accounts.map(t=>{const o=t.client?.name||"Sin cliente";let s=t.currentBalance??t.initialBalance??0;if(this.movements.length>0){const h=t.id||t.accountId,m=this.movements.filter(C=>C.accountId===h).sort((C,P)=>new Date(P.date).getTime()-new Date(C.date).getTime())[0];m&&m.balance&&(s=m.balance,t.currentBalance=m.balance)}return{value:t.id||t.accountId,label:t.accountNumber,secondaryLabel:`${o} - Saldo: $${s.toFixed(2)}`}})}formatCurrency(t){return`$${t.toFixed(2)}`}static#e=i=()=>(this.\u0275fac=function(o){return new(o||g)(e.\u0275\u0275directiveInject(l),e.\u0275\u0275directiveInject(b.D),e.\u0275\u0275directiveInject(u.J),e.\u0275\u0275directiveInject(c.FormBuilder))},this.\u0275cmp=e.\u0275\u0275defineComponent({type:g,selectors:[["app-movements-page"]],decls:11,vars:7,consts:[[1,"movements-page"],[1,"page-header"],[1,"page-title"],[1,"page-actions"],["type","primary",3,"clicked"],[1,"search-section"],["placeholder","Buscar",3,"ngModelChange","input","ngModel"],[3,"actionClick","sortChange","data","columns","actions","showPagination","pageSize"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"modal-close",3,"click"],[1,"modal-body",3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"form-group"],[1,"form-label"],["formControlName","accountId","placeholder","Buscar cuenta...",3,"options"],["class","error-message",4,"ngIf"],["formControlName","movementType",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["label","Valor","type","number","formControlName","amount",3,"required","errorMessage"],["class","balance-info",4,"ngIf"],[1,"modal-footer"],["htmlType","button","type","secondary",3,"clicked"],["htmlType","submit","type","primary",3,"disabled"],[1,"error-message"],[3,"value"],[1,"balance-info"],[1,"balance-card"],[1,"balance-current"],[3,"balance-warning","balance-error",4,"ngIf"],["class","insufficient-balance-message",4,"ngIf"],[1,"insufficient-balance-message"]],template:function(o,s){1&o&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h1",2),e.\u0275\u0275text(3,"Movimientos"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",3)(5,"app-button",4),e.\u0275\u0275listener("clicked",function(){return s.openCreateModal()}),e.\u0275\u0275text(6," Nuevo "),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",5)(8,"app-input",6),e.\u0275\u0275twoWayListener("ngModelChange",function(m){return e.\u0275\u0275twoWayBindingSet(s.searchTerm,m)||(s.searchTerm=m),m}),e.\u0275\u0275listener("input",function(m){return s.onSearchChange(m)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"app-table",7),e.\u0275\u0275listener("actionClick",function(m){return s.onTableAction(m)})("sortChange",function(m){return s.onSortChange(m)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,$,29,11,"div",8),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(8),e.\u0275\u0275twoWayProperty("ngModel",s.searchTerm),e.\u0275\u0275advance(),e.\u0275\u0275property("data",s.filteredMovements)("columns",s.tableColumns)("actions",s.tableActions)("showPagination",!0)("pageSize",s.pageSize),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",s.showModal))},dependencies:[n.CommonModule,n.NgForOf,n.NgIf,c.ReactiveFormsModule,c.\u0275NgNoValidate,c.NgSelectOption,c.\u0275NgSelectMultipleOption,c.SelectControlValueAccessor,c.NgControlStatus,c.NgControlStatusGroup,c.RequiredValidator,c.FormGroupDirective,c.FormControlName,c.FormsModule,c.NgModel,S.Q,M.S,O.O,a.w,n.CurrencyPipe],styles:['@charset "UTF-8";.movements-page[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:var(--spacing-6)}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-6);padding-bottom:var(--spacing-4);border-bottom:1px solid var(--gray-200)}.page-title[_ngcontent-%COMP%]{font-size:var(--font-size-3xl);font-weight:600;color:var(--gray-800);margin:0}.page-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-3)}.search-section[_ngcontent-%COMP%]{margin-bottom:var(--spacing-6);max-width:400px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:var(--spacing-4)}.modal-content[_ngcontent-%COMP%]{background-color:var(--white);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-lg);width:100%;max-width:700px;max-height:90vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-6);border-bottom:1px solid var(--gray-200)}.modal-title[_ngcontent-%COMP%]{font-size:var(--font-size-xl);font-weight:600;color:var(--gray-800);margin:0}.modal-close[_ngcontent-%COMP%]{background:none;border:none;font-size:var(--font-size-2xl);color:var(--gray-500);cursor:pointer;padding:var(--spacing-2);line-height:1;transition:color .2s ease}.modal-close[_ngcontent-%COMP%]:hover{color:var(--gray-700)}.modal-body[_ngcontent-%COMP%]{padding:var(--spacing-6)}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-3);padding:var(--spacing-6);border-top:1px solid var(--gray-200);background-color:var(--gray-50)}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--spacing-4);margin-bottom:var(--spacing-6)}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-2)}.form-label[_ngcontent-%COMP%]{font-size:var(--font-size-sm);font-weight:500;color:var(--gray-700)}.form-select[_ngcontent-%COMP%]{padding:var(--spacing-3) var(--spacing-4);border:1px solid var(--gray-300);border-radius:var(--border-radius-md);background-color:var(--white);color:var(--gray-800);font-family:var(--font-family);font-size:var(--font-size-base);transition:all .2s ease;outline:none}.form-select[_ngcontent-%COMP%]:focus{border-color:var(--primary-color);box-shadow:0 0 0 2px #3b82f61a}.form-select[_ngcontent-%COMP%]:invalid{color:var(--gray-400)}.error-message[_ngcontent-%COMP%]{font-size:var(--font-size-xs);color:var(--error-color);margin-top:var(--spacing-1)}.balance-info[_ngcontent-%COMP%]{margin-top:var(--spacing-6)}.balance-card[_ngcontent-%COMP%]{background-color:var(--gray-50);border:1px solid var(--gray-200);border-radius:var(--border-radius-md);padding:var(--spacing-4)}.balance-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:var(--font-size-lg);font-weight:600;color:var(--gray-800);margin:0 0 var(--spacing-3) 0}.balance-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:var(--spacing-2) 0;color:var(--gray-700);font-size:var(--font-size-sm)}.balance-current[_ngcontent-%COMP%]{font-size:var(--font-size-base)!important;font-weight:600!important;color:var(--primary-color)!important;background-color:#3b82f60d;padding:var(--spacing-2);border-radius:var(--border-radius-sm);border-left:3px solid var(--primary-color)}.balance-warning[_ngcontent-%COMP%]{color:var(--warning-color)!important;font-weight:500;background-color:#f59e0b1a;padding:var(--spacing-2);border-radius:var(--border-radius-sm);border-left:3px solid var(--warning-color)}.balance-error[_ngcontent-%COMP%]{color:var(--error-color)!important;font-weight:600;background-color:#ef44441a;padding:var(--spacing-2);border-radius:var(--border-radius-sm);border-left:3px solid var(--error-color)}.insufficient-balance-message[_ngcontent-%COMP%]{color:var(--error-color)!important;font-weight:600;font-size:var(--font-size-sm);background-color:#ef444426;padding:var(--spacing-3);border-radius:var(--border-radius-sm);border:1px solid var(--error-color);margin-top:var(--spacing-3)!important;text-align:center}@media (max-width: 768px){.movements-page[_ngcontent-%COMP%]{padding:var(--spacing-4)}.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:var(--spacing-4);align-items:stretch}.page-actions[_ngcontent-%COMP%]{justify-content:center}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.modal-content[_ngcontent-%COMP%]{margin:var(--spacing-4);max-height:calc(100vh - 2rem)}.modal-header[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{padding:var(--spacing-4)}.modal-footer[_ngcontent-%COMP%]{flex-direction:column}.balance-card[_ngcontent-%COMP%]{padding:var(--spacing-3)}}@media (max-width: 480px){.movements-page[_ngcontent-%COMP%]{padding:var(--spacing-3)}.page-title[_ngcontent-%COMP%]{font-size:var(--font-size-2xl)}.modal-content[_ngcontent-%COMP%]{margin:var(--spacing-2);max-height:calc(100vh - 1rem)}.balance-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:var(--font-size-base)}}']}))}return i(),g})()}}]);